- name: Test case
  block:
    - name: Create Deployment Resource Pool
      google.cloud.gcp_vertexai_deployment_resource_pool:
        state: present
        name: "{{`{{ resource_name }}`}}"
        dedicated_resources:
          min_replica_count: 1
          max_replica_count: 3
          machine_spec:
            machine_type: n1-standard-4
            accelerator_type: NVIDIA_TESLA_P4
            accelerator_count: 1
        region: us-central1
        project: "{{`{{ gcp_project }}`}}"
        auth_kind: "{{`{{ gcp_cred_kind }}`}}"
        service_account_file: "{{`{{ gcp_cred_file }}`}}"
      register: _mydpr

    - name: Run assertions
      ansible.builtin.assert:
        that:
          - _mydpr.changed == true

    - name: Update Deployment Resource Pool
      google.cloud.gcp_vertexai_deployment_resource_pool:
        state: present
        name: "{{`{{ resource_name }}`}}"
        dedicated_resources:
          min_replica_count: 1
          max_replica_count: 4
          machine_spec:
            machine_type: n1-standard-4
            accelerator_type: NVIDIA_TESLA_P4
            accelerator_count: 1
        region: us-central1
        project: "{{`{{ gcp_project }}`}}"
        auth_kind: "{{`{{ gcp_cred_kind }}`}}"
        service_account_file: "{{`{{ gcp_cred_file }}`}}"
      register: _mydpr

    - name: Run assertions
      ansible.builtin.assert:
        that:
          - _mydpr.changed == true

  always:
    - name: Delete Deployment Resource Pool
      google.cloud.gcp_vertexai_deployment_resource_pool:
        state: absent
        name: "{{`{{ resource_name }}`}}"
        region: us-central1
        project: "{{`{{ gcp_project }}`}}"
        auth_kind: "{{`{{ gcp_cred_kind }}`}}"
        service_account_file: "{{`{{ gcp_cred_file }}`}}"