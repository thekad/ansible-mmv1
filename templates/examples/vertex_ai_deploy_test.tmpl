- name: Test case
  block:
    - name: Deploy Basic Model
      google.cloud.gcp_vertexai_endpoint_with_model_garden_deployment:
        state: present
        publisher_model_name: publishers/google/models/paligemma@paligemma-224-float32
        display_name: "{{`{{ resource_name }}`}}"
        model_config:
          accept_eula: true
        location: us-central1
        project: "{{`{{ gcp_project }}`}}"
        auth_kind: "{{`{{ gcp_cred_kind }}`}}"
        service_account_file: "{{`{{ gcp_cred_file }}`}}"
      register: _mydeploy

    - name: Run assertions
      ansible.builtin.assert:
        that:
          - _mydeploy.changed == true

  always:
    - name: Deploy Basic Model
      google.cloud.gcp_vertexai_endpoint_with_model_garden_deployment:
        state: absent
        publisher_model_name: publishers/google/models/paligemma@paligemma-224-float32
        display_name: "{{`{{ resource_name }}`}}"
        location: us-central1
        project: "{{`{{ gcp_project }}`}}"
        auth_kind: "{{`{{ gcp_cred_kind }}`}}"
        service_account_file: "{{`{{ gcp_cred_file }}`}}"