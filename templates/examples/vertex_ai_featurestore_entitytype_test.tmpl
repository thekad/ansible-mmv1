- name: Test case
  block:
    - name: Create Featurestore
      google.cloud.gcp_vertexai_featurestore:
        state: present
        name: "{{`{{ resource_name | regex_replace('-', '_') }}`}}_et"
        online_serving_config:
          fixed_node_count: 2
        region: us-central1
        project: "{{`{{ gcp_project }}`}}"
        auth_kind: "{{`{{ gcp_cred_kind }}`}}"
        service_account_file: "{{`{{ gcp_cred_file }}`}}"
      register: _myfs

    - name: Create Featurestore Entitytype
      google.cloud.gcp_vertexai_featurestore_entitytype:
        state: present
        name: "{{`{{ resource_name | regex_replace('-', '_') }}`}}"
        featurestore: "{{`{{ _myfs.name }}`}}"
        project: "{{`{{ gcp_project }}`}}"
        auth_kind: "{{`{{ gcp_cred_kind }}`}}"
        service_account_file: "{{`{{ gcp_cred_file }}`}}"

    - name: Delete Featurestore Entitytype
      google.cloud.gcp_vertexai_featurestore_entitytype:
        state: absent
        name: "{{`{{ resource_name | regex_replace('-', '_') }}`}}"
        featurestore: "{{`{{ _myfs.name }}`}}"
        project: "{{`{{ gcp_project }}`}}"
        auth_kind: "{{`{{ gcp_cred_kind }}`}}"
        service_account_file: "{{`{{ gcp_cred_file }}`}}"
      ignore_errors: true

  always:
    - name: Delete Featurestore
      google.cloud.gcp_vertexai_featurestore:
        state: absent
        name: "{{`{{ resource_name | regex_replace('-', '_') }}`}}_et"
        region: us-central1
        project: "{{`{{ gcp_project }}`}}"
        auth_kind: "{{`{{ gcp_cred_kind }}`}}"
        service_account_file: "{{`{{ gcp_cred_file }}`}}"