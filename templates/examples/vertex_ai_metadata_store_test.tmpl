- name: Create Metadata Store
  google.cloud.gcp_vertexai_metadata_store:
    state: present
    name: "{{`{{ resource_name }}`}}"
    region: us-central1
    project: "{{`{{ gcp_project }}`}}"
    auth_kind: "{{`{{ gcp_cred_kind }}`}}"
    service_account_file: "{{`{{ gcp_cred_file }}`}}"
  register: _mymds

- name: Run assertions
  ansible.builtin.assert:
    that:
      - _mymds.changed == true

- name: Noop Metadata Store
  google.cloud.gcp_vertexai_metadata_store:
    state: present
    name: "{{`{{ resource_name }}`}}"
    region: us-central1
    project: "{{`{{ gcp_project }}`}}"
    auth_kind: "{{`{{ gcp_cred_kind }}`}}"
    service_account_file: "{{`{{ gcp_cred_file }}`}}"
  register: _mymds

- name: Run assertions
  ansible.builtin.assert:
    that:
      - _mymds.changed == false

- name: Attempt to update Metadata Store
  google.cloud.gcp_vertexai_metadata_store:
    state: present
    name: "{{`{{ resource_name }}`}}"
    description: "Updated description"
    region: us-central1
    project: "{{`{{ gcp_project }}`}}"
    auth_kind: "{{`{{ gcp_cred_kind }}`}}"
    service_account_file: "{{`{{ gcp_cred_file }}`}}"
  ignore_errors: true  # metadata stores cannot be updated so this should fail
  register: _mymds

- name: Run assertions
  ansible.builtin.assert:
    that:
      - _mymds.failed == true

- name: Delete Metadata Store
  google.cloud.gcp_vertexai_metadata_store:
    state: absent
    name: "{{`{{ resource_name }}`}}"
    region: us-central1
    project: "{{`{{ gcp_project }}`}}"
    auth_kind: "{{`{{ gcp_cred_kind }}`}}"
    service_account_file: "{{`{{ gcp_cred_file }}`}}"